<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">

    <script type="text/javascript" src="qrcode.js"></script>
    <!-- <script type="text/javascript" src="script.js"></script> -->

    <title>MY QR</title>
</head>

<body>
    <div class="topnav">
        <div class="topnavText">MY QR</div>
    </div>
    <div class="cta">
        <div class="text">
            <h3>QR CODE GENERATOR!</h3>
        </div>
        <hr>
        <div class="textbox">
            <input type="text" name="content" id="content" placeholder="start Typing..." onkeypress="keyPress(event)">
        </div>
        <br>
        <!-- <a href="/" id="qrcode" ></a> -->
        <div id="qrcode"></div>

        <br>
        <div class="generatebutton">
            <!-- <button type="submit" onclick="download()">Download</button> -->
        </div>
    </div>



    <script>
        var qrcode = new QRCode(document.getElementById("qrcode"), {
            width: 300,
            height: 300
        });
        
        function makeCode() {
            // var imgsrc='';
            var elText = document.getElementById("content");
            if (!elText.value) {
                alert("Input a text");
                elText.focus();
                return;
            }

            qrcode.makeCode(elText.value);
            // console.log(qrcode);
            var getImage=document.getElementById("qrcode");
            setTimeout(()=>{
            var imgsrc=getImage.childNodes[1].src;
                //console.log(imgsrc);
                alert("downloading Image"+imgsrc);
                if(imgsrc=="")
                {
                    imgsrc=initilizeImage();
                }
                download(imgsrc);
            },2000)
        }
        //makeCode();
        function keyPress(event) {
            // console.log("i m triggered");
            // console.log(event);
            if (event.keyCode == 13) {
                makeCode();
            }
            
        }
        function initilizeImage()
        {
            var s=document.getElementById("qrcode").childNodes[1].src;
            if(s==='')
            {
                alert("unable to initilixze image" )
                setInterval(()=>{
                    if(s=="")
                    {
                        alert("unable to initilixze image" );

                    }
                },1000);
            }
            return s; 
        }
        function download(imgsrc){
            //   const fileName = source.split('/').pop();
    alert("downloading Image"+imgsrc);
	var el = document.createElement("a");
	el.setAttribute("href", imgsrc);
	el.setAttribute("download", "Qr");
	document.body.appendChild(el);
 	el.click();
	el.remove();
}
    </script>
</body>

</html>